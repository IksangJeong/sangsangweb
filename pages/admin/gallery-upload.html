<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>ì‚¬ì§„ ì˜¬ë¦¬ê¸° - ìƒìƒë§ˆë£¨</title>
    <link rel="stylesheet" href="../../css/globals.css" />
    <link rel="stylesheet" href="../../css/variables.css" />
    <link rel="stylesheet" href="../../css/dropdown.css" />
    <link rel="stylesheet" href="../../css/common.css" />
    <link rel="stylesheet" href="write.css" />
    <script src="../../js/api.js" defer></script>
    <style>
      .image-upload-area {
        border: 2px dashed #ddd;
        border-radius: 12px;
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        transition: border-color 0.2s, background-color 0.2s;
      }
      .image-upload-area:hover {
        border-color: #1F63C9;
        background-color: #f8faff;
      }
      .image-upload-area.dragover {
        border-color: #1F63C9;
        background-color: #e8f0ff;
      }
      .image-upload-area input[type="file"] {
        display: none;
      }
      .upload-icon {
        font-size: 48px;
        color: #94A3B8;
        margin-bottom: 12px;
      }
      .upload-text {
        color: #6A7282;
        font-size: 14px;
      }
      .upload-text strong {
        color: #1F63C9;
      }
      .image-preview {
        margin-top: 20px;
        display: none;
      }
      .image-preview img {
        max-width: 100%;
        max-height: 300px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      .image-preview .remove-btn {
        display: inline-block;
        margin-top: 10px;
        padding: 8px 16px;
        background-color: #dc3545;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }
      .image-preview .remove-btn:hover {
        background-color: #c82333;
      }
    </style>
  </head>
  <body>
    <div class="admin-page">
      <header class="nav-container">
        <nav class="nav-inner-container">
          <div class="nav-logo-box">
            <a href="../../index.html">
              <img src="../../img/logo.png" alt="ìƒìƒ ë§ˆë£¨" class="nav-logo" />
            </a>
          </div>
          <ul class="navbar" role="menubar">
            <li class="div nav-item" role="menuitem">
              <a href="../about/greeting.html">ë‹¨ì²´ì†Œê°œ</a>
              <ul class="dropdown-menu">
                <li><a href="../about/greeting.html">ì¸ì‚¬ë§</a></li>
                <li><a href="../about/history.html">ì—°í˜</a></li>
                <li><a href="../about/location.html">ì˜¤ì‹œëŠ” ê¸¸</a></li>
              </ul>
            </li>
            <li class="div nav-item no-dropdown" role="menuitem">
              <a href="#">ì§„ë¡œÂ·ì§ì—…ì²´í—˜</a>
            </li>
            <li class="div nav-item" role="menuitem">
              <a href="../education/afterschool.html">êµìœ¡í™œë™</a>
              <ul class="dropdown-menu">
                <li><a href="../education/afterschool.html">ë°©ê³¼í›„/ëŠ˜ë´„ êµìœ¡</a></li>
                <li><a href="../education/outside.html">í•™êµë°– ëŠ˜ë´„êµìœ¡</a></li>
                <li><a href="../education/freeyear.html">ììœ í•™ë…„(ê¸°)ì œ</a></li>
                <li><a href="../education/drone.html">íƒ‘ë§ˆë£¨ë“œë¡ ì¶•êµ¬ë‹¨</a></li>
                <li><a href="../education/hrd.html">HRD-Netê°•ì‚¬ì–‘ì„±ê³¼ì •</a></li>
                <li><a href="../education/volunteer.html">êµìœ¡ê¸°ë¶€ ì§„ë¡œì²´í—˜</a></li>
              </ul>
            </li>
            <li class="div nav-item" role="menuitem">
              <a href="../experience/creative.html">ì²´í—˜í™œë™</a>
              <ul class="dropdown-menu">
                <li><a href="../experience/creative.html">ì°½ì˜ì ì²´í—˜í™œë™</a></li>
                <li><a href="../experience/swai.html">SW.AIêµìœ¡ì£¼ê°„</a></li>
                <li><a href="../experience/science.html">ê³¼í•™ì˜ë‚  í–‰ì‚¬ ì§€ì›</a></li>
                <li><a href="../experience/culture.html">ë¬¸í™”ì˜ˆìˆ ì²´í—˜ êµìœ¡</a></li>
              </ul>
            </li>
            <li class="div nav-item active" role="menuitem">
              <a href="../community/notice.html">ì»¤ë®¤ë‹ˆí‹°</a>
              <ul class="dropdown-menu">
                <li><a href="../community/notice.html">ê³µì§€ì‚¬í•­</a></li>
                <li><a href="../community/press.html">ë³´ë„ìë£Œ</a></li>
                <li><a href="../community/gallery.html">í¬í† ê°¤ëŸ¬ë¦¬</a></li>
              </ul>
            </li>
            <li class="div nav-item no-dropdown" role="menuitem">
              <a href="../store/store.html">ìŠ¤í† ì–´</a>
            </li>
          </ul>
          <div class="nav-button-box">
            <!-- JSë¡œ ì—…ë°ì´íŠ¸ -->
          </div>
        </nav>
      </header>

      <main class="admin-content">
        <div class="admin-container">
          <h2 class="admin-title">ì‚¬ì§„ ì˜¬ë¦¬ê¸°</h2>

          <form id="upload-form" class="write-form">
            <div class="form-group">
              <label for="title">ì œëª©</label>
              <input type="text" id="title" name="title" placeholder="ì‚¬ì§„ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required maxlength="255" />
            </div>

            <div class="form-group">
              <label>ì‚¬ì§„ ì„ íƒ</label>
              <div class="image-upload-area" id="upload-area">
                <input type="file" id="image" name="image" accept="image/*" required />
                <div class="upload-icon">ğŸ“·</div>
                <p class="upload-text">
                  <strong>í´ë¦­</strong>í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—¬ê¸°ì— <strong>ë“œë˜ê·¸</strong>í•˜ì„¸ìš”
                </p>
                <p class="upload-text">JPG, PNG, GIF (ìµœëŒ€ 5MB)</p>
              </div>
              <div class="image-preview" id="preview">
                <img id="preview-image" src="" alt="ë¯¸ë¦¬ë³´ê¸°" />
                <button type="button" class="remove-btn" id="remove-btn">ì´ë¯¸ì§€ ì‚­ì œ</button>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="history.back()">ì·¨ì†Œ</button>
              <button type="submit" class="btn btn-primary">ì—…ë¡œë“œ</button>
            </div>
          </form>

          <div id="message" class="message"></div>
        </div>
      </main>

      <footer class="footer">
        <div class="footer-inner">
          <div class="footer-info">
            <address>
              <p>ì „ë¶íŠ¹ë³„ìì¹˜ë„ ìµì‚°ì‹œ ì›ê´‘ëŒ€í•™êµ í”„ë¼ì„ê´€</p>
              <p>ì‚¬ì—…ì ë²ˆí˜¸ : 651-86-01854(ë“±ë¡ 2006ë…„)</p>
              <p>ìƒí˜¸ : ìƒìƒë§ˆë£¨ (Sangsangmaru) / ì§„ë¡œì§„í•™ì²´í—˜ì§€ì›ì„¼í„° ëŒ€í‘œ : ì¡°ì§„ìš±</p>
              <p>ê³ ê°ì„¼í„° : 1544-0634 íŒ©ìŠ¤ : 0505-200-6060 ì´ë©”ì¼ : cybercops@wku.ac.kr</p>
            </address>
          </div>
          <div class="footer-bottom">
            <p class="copyright">â“’ ìœ í•œíšŒì‚¬ ìƒìƒë§ˆë£¨ All rights reserved.</p>
          </div>
        </div>
      </footer>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', async function() {
        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        try {
          const response = await AuthAPI.checkStatus();

          if (!response.logged_in) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = '../login.html?redirect=/pages/admin/gallery-upload.html';
            return;
          }

          // ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
          UIHelper.updateNavigation();

        } catch (error) {
          alert('ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          window.location.href = '../../index.html';
          return;
        }

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ ì„¤ì •
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('image');
        const preview = document.getElementById('preview');
        const previewImage = document.getElementById('preview-image');
        const removeBtn = document.getElementById('remove-btn');

        // í´ë¦­ìœ¼ë¡œ íŒŒì¼ ì„ íƒ
        uploadArea.addEventListener('click', () => fileInput.click());

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        uploadArea.addEventListener('dragover', (e) => {
          e.preventDefault();
          uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
          uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
          e.preventDefault();
          uploadArea.classList.remove('dragover');
          const files = e.dataTransfer.files;
          if (files.length > 0 && files[0].type.startsWith('image/')) {
            fileInput.files = files;
            showPreview(files[0]);
          }
        });

        // íŒŒì¼ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸°
        fileInput.addEventListener('change', (e) => {
          if (e.target.files.length > 0) {
            showPreview(e.target.files[0]);
          }
        });

        // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function showPreview(file) {
          if (file.size > 5 * 1024 * 1024) {
            alert('íŒŒì¼ í¬ê¸°ê°€ 5MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.');
            fileInput.value = '';
            return;
          }

          const reader = new FileReader();
          reader.onload = (e) => {
            previewImage.src = e.target.result;
            preview.style.display = 'block';
            uploadArea.style.display = 'none';
          };
          reader.readAsDataURL(file);
        }

        // ì´ë¯¸ì§€ ì‚­ì œ
        removeBtn.addEventListener('click', () => {
          fileInput.value = '';
          preview.style.display = 'none';
          uploadArea.style.display = 'block';
        });

        // í¼ ì œì¶œ
        const form = document.getElementById('upload-form');
        const messageEl = document.getElementById('message');

        form.addEventListener('submit', async function(e) {
          e.preventDefault();

          const title = document.getElementById('title').value.trim();
          const imageFile = fileInput.files[0];

          if (!title) {
            messageEl.textContent = 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
            messageEl.className = 'message error';
            return;
          }

          if (!imageFile) {
            messageEl.textContent = 'ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.';
            messageEl.className = 'message error';
            return;
          }

          try {
            const formData = new FormData();
            formData.append('title', title);
            formData.append('image', imageFile);

            const response = await GalleryAPI.create(formData);

            if (response.success) {
              messageEl.textContent = 'ì‚¬ì§„ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.';
              messageEl.className = 'message success';

              setTimeout(() => {
                window.location.href = '../community/gallery.html';
              }, 1000);
            } else {
              throw new Error(response.error || 'ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
          } catch (error) {
            messageEl.textContent = error.message || 'ì‚¬ì§„ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            messageEl.className = 'message error';
          }
        });
      });
    </script>
  </body>
</html>
