<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>보도자료 - 상상 마루</title>
    <link rel="stylesheet" href="../../css/globals.css" />
    <link rel="stylesheet" href="../../css/variables.css" />
    <link rel="stylesheet" href="../../css/common.css" />
    <link rel="stylesheet" href="../../css/dropdown.css" />
    <link rel="stylesheet" href="../../css/animations.css" />
    <link rel="stylesheet" href="community.css" />
    <link rel="stylesheet" href="../../css/responsive.css" />
    <script src="../../js/api.js" defer></script>
  </head>
  <body>
    <div class="community-page">
      <header class="nav-container">
        <nav class="nav-inner-container">
          <div class="nav-logo-box">
            <a href="../../index.html"><img src="../../img/logo.png" alt="상상 마루" class="nav-logo" /></a>
          </div>
          <ul class="navbar" role="menubar">
            <li class="div nav-item" role="menuitem">
              <a href="../about/greeting.html">단체소개</a>
              <ul class="dropdown-menu">
                <li><a href="../about/greeting.html">인사말</a></li>
                <li><a href="../about/history.html">연혁</a></li>
                <li><a href="../about/location.html">오시는 길</a></li>
              </ul>
            </li>
            <li class="div nav-item no-dropdown" role="menuitem">
              <a href="#">진로·직업체험</a>
            </li>
            <li class="div nav-item" role="menuitem">
              <a href="../education/afterschool.html">교육활동</a>
              <ul class="dropdown-menu">
                <li><a href="../education/afterschool.html">방과후/늘봄 교육</a></li>
                <li><a href="../education/outside.html">학교밖 늘봄교육</a></li>
                <li><a href="../education/freeyear.html">자유학년(기)제</a></li>
                <li><a href="../education/drone.html">탑마루드론축구단</a></li>
                <li><a href="../education/hrd.html">HRD-Net강사양성과정</a></li>
                <li><a href="../education/volunteer.html">교육기부 진로체험</a></li>
              </ul>
            </li>
            <li class="div nav-item" role="menuitem">
              <a href="../experience/creative.html">체험활동</a>
              <ul class="dropdown-menu">
                <li><a href="../experience/creative.html">창의적체험활동</a></li>
                <li><a href="../experience/swai.html">SW.AI교육주간</a></li>
                <li><a href="../experience/science.html">과학의날 행사 지원</a></li>
                <li><a href="../experience/culture.html">문화예술체험 교육</a></li>
              </ul>
            </li>
            <li class="div nav-item" role="menuitem">
              <a href="notice.html">커뮤니티</a>
              <ul class="dropdown-menu">
                <li><a href="notice.html">공지사항</a></li>
                <li><a href="press.html" class="active">보도자료</a></li>
                <li><a href="gallery.html">포토갤러리</a></li>
              </ul>
            </li>
            <li class="div nav-item no-dropdown" role="menuitem">
              <a href="../store/store.html">스토어</a>
            </li>
          </ul>
          <div class="nav-button-box">
            <a href="../login.html" class="nav-button" aria-label="로그인">
              <span class="text-wrapper-2">로그인</span>
            </a>
            <a href="../signup.html" class="div-wrapper" aria-label="회원가입">
              <span class="text-wrapper-3">회원가입</span>
            </a>
          </div>
        </nav>
      </header>

      <main class="community-content">
        <div class="community-container">
          <aside class="community-sidebar" aria-label="커뮤니티 메뉴">
            <div class="sidebar-header">
              <h1 class="sidebar-title">커뮤니티</h1>
            </div>
            <nav class="sidebar-menu" aria-label="커뮤니티 하위 메뉴">
              <a href="notice.html" class="menu-item">
                <span>공지사항</span>
                <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </a>
              <a href="press.html" class="menu-item active" aria-current="page">
                <span>보도자료</span>
                <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </a>
              <a href="gallery.html" class="menu-item">
                <span>포토갤러리</span>
                <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </a>
            </nav>
          </aside>

          <section class="community-main" aria-labelledby="press-title">
            <div class="section-header">
              <h2 class="section-title" id="press-title">보도자료</h2>
              <div class="section-underline" aria-hidden="true"></div>
              <!-- 관리자 글 작성 버튼 -->
              <a href="../admin/write.html?type=press" id="write-btn" class="write-btn" style="display: none;">
                <span>글 작성</span>
              </a>
            </div>

            <div class="notice-table">
              <div class="table-header" role="row">
                <div class="col-num" role="columnheader">번호</div>
                <div class="col-title" role="columnheader">제목</div>
                <div class="col-author" role="columnheader">작성자</div>
                <div class="col-date" role="columnheader">작성일</div>
                <div class="col-views" role="columnheader">조회</div>
              </div>

              <div id="post-list">
                <div class="loading-message">게시글을 불러오는 중...</div>
              </div>
            </div>

            <!-- 페이지네이션 -->
            <nav class="pagination" id="pagination" aria-label="페이지 네비게이션"></nav>
          </section>
        </div>
      </main>

      <footer class="footer-container">
        <div class="footer-inner">
          <div class="footer-info">
            <address class="footer-address">
              <p>전북특별자치도 익산시 원광대학교 프라임관</p>
              <p>사업자 번호 : 651-86-01854(등록 2006년)</p>
              <p>상호 : 상상마루 (Sangsangmaru) / 진로진학체험지원센터 대표 : 조진욱</p>
              <p>고객센터 : 1544-0634 팩스 : 0505-200-6060 이메일 : cybercops@wku.ac.kr</p>
            </address>
          </div>
          <div class="footer-bottom">
            <p class="copyright">ⓒ 유한회사 상상마루 All rights reserved.</p>
          </div>
        </div>
      </footer>
    </div>

    <script>
      let currentPage = 1;
      const POSTS_PER_PAGE = 10;

      // HTML 이스케이프
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // 게시글 목록 로드
      async function loadPosts(page = 1) {
        const container = document.getElementById('post-list');

        try {
          const response = await PostsAPI.list('press', page, POSTS_PER_PAGE);

          if (response.success) {
            renderPostList(response.data);
            if (response.pagination) {
              renderPagination(response.pagination);
            }
          } else {
            container.innerHTML = '<div class="no-posts">게시글을 불러오는데 실패했습니다.</div>';
          }
        } catch (error) {
          console.error('게시글 로드 실패:', error);
          container.innerHTML = '<div class="no-posts">게시글을 불러오는데 실패했습니다.</div>';
        }
      }

      // 게시글 목록 렌더링
      function renderPostList(posts) {
        const container = document.getElementById('post-list');

        if (!posts || posts.length === 0) {
          container.innerHTML = '<div class="no-posts">등록된 게시글이 없습니다.</div>';
          return;
        }

        container.innerHTML = posts.map(post => `
          <article class="table-row" role="row">
            <div class="col-num" role="cell">${post.id}</div>
            <div class="col-title" role="cell">
              <a href="view.html?id=${post.id}">${escapeHtml(post.title)}</a>
            </div>
            <div class="col-author" role="cell">${escapeHtml(post.author || post.author_name || '관리자')}</div>
            <div class="col-date" role="cell">
              <time datetime="${post.created_at}">${post.created_at_formatted || post.created_at}</time>
            </div>
            <div class="col-views" role="cell">${post.views || 0}</div>
          </article>
        `).join('');
      }

      // 페이지네이션 렌더링
      function renderPagination(pagination) {
        const container = document.getElementById('pagination');
        if (!pagination || pagination.total_pages <= 1) {
          container.innerHTML = '';
          return;
        }

        let html = '';

        // 이전 버튼
        if (pagination.page > 1) {
          html += `<button class="page-btn" onclick="goToPage(${pagination.page - 1})">이전</button>`;
        }

        // 페이지 번호
        for (let i = 1; i <= pagination.total_pages; i++) {
          if (i === pagination.page) {
            html += `<span class="page-btn current">${i}</span>`;
          } else {
            html += `<button class="page-btn" onclick="goToPage(${i})">${i}</button>`;
          }
        }

        // 다음 버튼
        if (pagination.page < pagination.total_pages) {
          html += `<button class="page-btn" onclick="goToPage(${pagination.page + 1})">다음</button>`;
        }

        container.innerHTML = html;
      }

      // 페이지 이동
      function goToPage(page) {
        currentPage = page;
        loadPosts(page);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      document.addEventListener('DOMContentLoaded', async function() {
        // 네비게이션 업데이트
        if (typeof UIHelper !== 'undefined') {
          await UIHelper.updateNavigation();

          // 관리자인 경우 글 작성 버튼 표시
          if (window.currentUser && window.currentUser.role === 'admin') {
            document.getElementById('write-btn').style.display = 'inline-flex';
          }
        }

        // 게시글 목록 로드
        loadPosts(currentPage);
      });
    </script>
  </body>
</html>
