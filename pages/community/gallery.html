<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>포토갤러리 - 상상 마루</title>
    <link rel="stylesheet" href="../../css/globals.css" />
    <link rel="stylesheet" href="../../css/variables.css" />
    <link rel="stylesheet" href="../../css/common.css" />
    <link rel="stylesheet" href="../../css/dropdown.css" />
    <link rel="stylesheet" href="../../css/animations.css" />
    <link rel="stylesheet" href="community.css" />
    <link rel="stylesheet" href="../../css/responsive.css" />
    <script src="../../js/api.js" defer></script>
  </head>
  <body>
    <div class="community-page">
      <header class="nav-container">
        <nav class="nav-inner-container">
          <div class="nav-logo-box">
            <a href="../../index.html"><img src="../../img/logo.png" alt="상상 마루" class="nav-logo" /></a>
          </div>
          <ul class="navbar" role="menubar">
            <li class="div nav-item" role="menuitem">
              <a href="../about/greeting.html">단체소개</a>
              <ul class="dropdown-menu">
                <li><a href="../about/greeting.html">인사말</a></li>
                <li><a href="../about/history.html">연혁</a></li>
                <li><a href="../about/location.html">오시는 길</a></li>
              </ul>
            </li>
            <li class="div nav-item no-dropdown" role="menuitem">
              <a href="#">진로·직업체험</a>
            </li>
            <li class="div nav-item" role="menuitem">
              <a href="../education/afterschool.html">교육활동</a>
              <ul class="dropdown-menu">
                <li><a href="../education/afterschool.html">방과후/늘봄 교육</a></li>
                <li><a href="../education/outside.html">학교밖 늘봄교육</a></li>
                <li><a href="../education/freeyear.html">자유학년(기)제</a></li>
                <li><a href="../education/drone.html">탑마루드론축구단</a></li>
                <li><a href="../education/hrd.html">HRD-Net강사양성과정</a></li>
                <li><a href="../education/volunteer.html">교육기부 진로체험</a></li>
              </ul>
            </li>
            <li class="div nav-item" role="menuitem">
              <a href="../experience/creative.html">체험활동</a>
              <ul class="dropdown-menu">
                <li><a href="../experience/creative.html">창의적체험활동</a></li>
                <li><a href="../experience/swai.html">SW.AI교육주간</a></li>
                <li><a href="../experience/science.html">과학의날 행사 지원</a></li>
                <li><a href="../experience/culture.html">문화예술체험 교육</a></li>
              </ul>
            </li>
            <li class="div nav-item" role="menuitem">
              <a href="notice.html">커뮤니티</a>
              <ul class="dropdown-menu">
                <li><a href="notice.html">공지사항</a></li>
                <li><a href="press.html">보도자료</a></li>
                <li><a href="gallery.html" class="active">포토갤러리</a></li>
              </ul>
            </li>
            <li class="div nav-item no-dropdown" role="menuitem">
              <a href="../store/store.html">스토어</a>
            </li>
          </ul>
          <div class="nav-button-box">
            <a href="../login.html" class="nav-button" aria-label="로그인">
              <span class="text-wrapper-2">로그인</span>
            </a>
            <a href="../signup.html" class="div-wrapper" aria-label="회원가입">
              <span class="text-wrapper-3">회원가입</span>
            </a>
          </div>
        </nav>
      </header>

      <main class="community-content">
        <div class="community-container">
          <aside class="community-sidebar" aria-label="커뮤니티 메뉴">
            <div class="sidebar-header">
              <h1 class="sidebar-title">커뮤니티</h1>
            </div>
            <nav class="sidebar-menu" aria-label="커뮤니티 하위 메뉴">
              <a href="notice.html" class="menu-item">
                <span>공지사항</span>
                <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </a>
              <a href="press.html" class="menu-item">
                <span>보도자료</span>
                <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </a>
              <a href="gallery.html" class="menu-item active" aria-current="page">
                <span>포토갤러리</span>
                <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </a>
            </nav>
          </aside>

          <section class="community-main" aria-labelledby="gallery-title">
            <div class="section-header">
              <h2 class="section-title" id="gallery-title">포토갤러리</h2>
              <div class="section-underline" aria-hidden="true"></div>
              <!-- 회원 글 작성 버튼 (로그인한 사용자 모두 가능) -->
              <a href="../admin/write.html?type=gallery" id="write-btn" class="write-btn" style="display: none;">
                <span>글 작성</span>
              </a>
            </div>

            <div id="gallery-list" class="gallery-grid">
              <!-- API에서 갤러리 데이터를 로드합니다 -->
              <div class="loading-message">갤러리를 불러오는 중...</div>
            </div>

            <nav id="pagination" class="pagination" aria-label="페이지 네비게이션">
              <!-- 페이지네이션 동적 생성 -->
            </nav>
          </section>
        </div>
      </main>

      <footer class="footer-container">
        <div class="footer-inner">
          <div class="footer-info">
            <address class="footer-address">
              <p>전북특별자치도 익산시 원광대학교 프라임관</p>
              <p>사업자 번호 : 651-86-01854(등록 2006년)</p>
              <p>상호 : 상상마루 (Sangsangmaru) / 진로진학체험지원센터 대표 : 조진욱</p>
              <p>고객센터 : 1544-0634 팩스 : 0505-200-6060 이메일 : cybercops@wku.ac.kr</p>
            </address>
          </div>
          <div class="footer-bottom">
            <p class="copyright">ⓒ 유한회사 상상마루 All rights reserved.</p>
          </div>
        </div>
      </footer>
    </div>

    <script>
      const ITEMS_PER_PAGE = 12;
      let currentPage = 1;

      document.addEventListener('DOMContentLoaded', async function() {
        // 네비게이션 업데이트
        if (typeof UIHelper !== 'undefined') {
          await UIHelper.updateNavigation();

          // 로그인한 사용자는 모두 글 작성 가능 (포토갤러리)
          if (window.currentUser) {
            const writeBtn = document.getElementById('write-btn');
            writeBtn.href = '../admin/gallery-upload.html';
            writeBtn.querySelector('span').textContent = '사진 올리기';
            writeBtn.style.display = 'inline-flex';
          }
        }

        // 갤러리 목록 로드
        await loadGallery(1);
      });

      // 갤러리 목록 로드
      async function loadGallery(page) {
        currentPage = page;
        const container = document.getElementById('gallery-list');
        const paginationContainer = document.getElementById('pagination');

        try {
          container.innerHTML = '<div class="loading-message">갤러리를 불러오는 중...</div>';

          const response = await GalleryAPI.list(page, ITEMS_PER_PAGE);

          if (response.success) {
            renderGalleryList(response.data);
            if (response.pagination) {
              renderPagination(response.pagination);
            }
          } else {
            container.innerHTML = '<div class="no-posts">갤러리 데이터를 불러올 수 없습니다.</div>';
          }
        } catch (error) {
          console.error('갤러리 로드 오류:', error);
          container.innerHTML = '<div class="no-posts">갤러리를 불러오는 중 오류가 발생했습니다.</div>';
        }
      }

      // 갤러리 목록 렌더링
      function renderGalleryList(items) {
        const container = document.getElementById('gallery-list');

        if (!items || items.length === 0) {
          container.innerHTML = '<div class="no-posts">등록된 사진이 없습니다.</div>';
          return;
        }

        container.innerHTML = items.map(item => `
          <article class="gallery-card" onclick="location.href='gallery-view.html?id=${item.id}'">
            <div class="gallery-thumbnail">
              ${item.thumbnail_path || item.image_path
                ? `<img src="${item.thumbnail_path || item.image_path}" alt="${escapeHtml(item.title)}" loading="lazy">`
                : '<span>사진</span>'}
            </div>
            <div class="gallery-info">
              <h3 class="gallery-title-text">${escapeHtml(item.title)}</h3>
              <time datetime="${item.created_at}" class="gallery-date">${item.created_at_formatted}</time>
            </div>
          </article>
        `).join('');
      }

      // 페이지네이션 렌더링
      function renderPagination(pagination) {
        const container = document.getElementById('pagination');
        const { current_page, total_pages } = pagination;

        if (total_pages <= 1) {
          container.innerHTML = '';
          return;
        }

        let html = '';

        // 이전 버튼
        if (current_page > 1) {
          html += `<button class="page-btn" onclick="loadGallery(${current_page - 1})">이전</button>`;
        }

        // 페이지 번호
        const startPage = Math.max(1, current_page - 2);
        const endPage = Math.min(total_pages, current_page + 2);

        for (let i = startPage; i <= endPage; i++) {
          if (i === current_page) {
            html += `<button class="page-btn current" disabled>${i}</button>`;
          } else {
            html += `<button class="page-btn" onclick="loadGallery(${i})">${i}</button>`;
          }
        }

        // 다음 버튼
        if (current_page < total_pages) {
          html += `<button class="page-btn" onclick="loadGallery(${current_page + 1})">다음</button>`;
        }

        container.innerHTML = html;
      }

      // HTML 이스케이프
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
    </script>
  </body>
</html>
